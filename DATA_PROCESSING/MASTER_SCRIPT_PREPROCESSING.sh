######################################################################################################################################################
######################################################################################################################################################
# analysis_scripts_H3K36_H3K27me3
# Cuvier's Lab
# David Depierre
# dav.depierre@gmail.com
# 2022.07
######################################################################################################################################################
######################################################################################################################################################

# MASTER SCRIPT DATA PRE-PROCESSING


######################################################################################################################################################
######################################################################################################################################################
##  ChIP-seq data
######################################################################################################################################################
######################################################################################################################################################
## This Script provides commmand lines with tools versions that have bene used to pre-process ChIP-seq data from fastq to bigwig and profile matrices.


######################################################################################################################################################
##  TRIM ADAPTER SEQUENCES + READS FILTERING AND QUALITY CONTROL
######################################################################################################################################################
# Trim Galore version: 0.4.0
# cutadapt 1.8.3
# FastQC_v0.11.7
# python-2.7.2

trim_galore -q 20 -stringency 5 --fastqc_args "--nogroup --outdir ./fastqc/trimmed_fqc" -o ./fastq/trimmed_fq ./fastq/chipseq_file.fq.gz

######################################################################################################################################################
## READS INDEX
######################################################################################################################################################
#  bwa-0.7.15 	
bwa aln -t 8 ./REF_GENOME/dmel-all-chromosome-r6.13.fasta ./fastq/trimmed_fq/chipseq_file_trimmed.fq > ./SAI/chipseq_file_trimmed.sai

######################################################################################################################################################
## READS ALIGNMENT
######################################################################################################################################################
#  bwa-0.7.15 	

bwa samse ./REF_GENOME/dmel-all-chromosome-r6.13.fasta ./SAI/chipseq_file_trimmed.sai ./fastq/trimmed_fq/chipseq_file_trimmed.fq > ./SAM/chipseq_file_trimmed.sam


######################################################################################################################################################
## ALIGNED READS FILTERING 
######################################################################################################################################################
# bash 	
# samtools-1.3.1 	

grep 'XT:A:U' ./SAM/chipseq_file_trimmed.sam > ./SAM/chipseq_file_trimmed.uniqsam

samtools view -bS -F 1540 -q 30 ./SAM/chipseq_file_trimmed_filt.sam -o ./BAM_filt/chipseq_file_trimmed_filt.bam


######################################################################################################################################################
## ALIGNED READS SORTING 
######################################################################################################################################################
# samtools-1.3.1 	

samtools sort ./BAM_filt/chipseq_file_trimmed_filt.bam -o ./BAM_sort/chipseq_file_trimmed_filt_sort.bam

######################################################################################################################################################
## CONVERT TO BIGWIG FORMAT 
######################################################################################################################################################
# python-3.4.3
# deepTools-2.5.3

bamCoverage --bam ./BAM_sort/chipseq_file_trimmed_filt_sort.bam --binSize 10 --normalizeTo1x 125464728 -o ./BIGWIG/chipseq_file_trimmed_filt_sort_RPGC.bw

######################################################################################################################################################
##  PROFILE MATRIX FOR QUANTIFICATION
######################################################################################################################################################
# python-3.4.3
# deepTools-2.5.3

computeMatrix scale-regions -S ./BIGWIG/chipseq_file_trimmed_filt_sort_RPGC.bw -R ./REF_GENOME/TxDb.Dmelanogaster.Ensembl.dm6.bed -bs 10 -m 4000 -a 2000 -b 4000 -out ./PROFIL_MATRIX/GB/chipseq_file_trimmed_filt_sort_RPGC.out --outFileNameMatrix ./PROFIL_MATRIX/GB/chipseq_file_trimmed_filt_sort_RPGC.outmatrix






######################################################################################################################################################
######################################################################################################################################################
##  RNA-seq data
######################################################################################################################################################
######################################################################################################################################################
## This Script provides commmand lines with tools versions that have bene used to pre-process ChIP-seq data from fastq to bigwig and profile matrices.


######################################################################################################################################################
##  TRIM ADAPTER SEQUENCES + READS FILTERING AND QUALITY CONTROL
######################################################################################################################################################
# Trim Galore version: 0.4.0
# cutadapt 1.8.3
# FastQC_v0.11.7
# python-2.7.2

trim_galore -q 20 -stringency 5 --fastqc_args "--nogroup --outdir ./fastqc/trimmed_fqc" -o ./fastq/trimmed_fq ./fastq/rnaseq_file.fq.gz

######################################################################################################################################################
##  READS ALIGNMENT
######################################################################################################################################################
# STAR-2.5.2b

STAR --readFilesCommand zcat --genomeDir ./REF_GENOME --runThreadN 20 --readFilesIn ./fastq/trimmed_fq/C_1_1_qseq_trimmed.fq.gz --outFileNamePrefix ./SAM/C_1_1_qseq_trimmed --outSJfilterReads Unique 	

######################################################################################################################################################
##  ALIGNED READS FILTERING
######################################################################################################################################################
# samtools-1.3.1

	samtools view -bS -F 1540 -q 30 ./SAM/C_1_1_qseq_trimmedAligned.out.sam -o ./BAM/C_1_1_filt.bam 	


######################################################################################################################################################
##  ALIGNED READS SORTING
######################################################################################################################################################
# samtools-1.3.1

	samtools sort ./BAM/C_1_1_filt.bam -o ./BAM_Sorted/C_1_1_filt_sort.bam 	

######################################################################################################################################################
##  CONVERT TO BIGWIG FORMAT 	
######################################################################################################################################################
# python-3.4.3 / deepTools-2.5.3 	

bamCoverage --bam ./BAM_Sorted/C_1_1_filt_sort.bam --binSize 10 --normalizeTo1x 125464728 -o ./BIGWIG/C_1_1_filt_sort_RPGC.bw 	

######################################################################################################################################################
##  QUANTIFICATION MATRIX OVER GENES 	
######################################################################################################################################################
# python-3.4.3
# deepTools-2.5.3 	
	
computeMatrix scale-regions -S ./BIGWIG/C_1_1_filt_sort.bw -R ./r6.13/TxDb.Dmelanogaster.Ensembl.dm6.bed -bs 10 -m 4000 -a 2000 -b 4000 -out ./PROFIL_MATRIX/GB/C_1_1_filt_sort.out --outFileNameMatrix ./PROFIL_MATRIX/GB/C_1_1_filt_sort.outmatrix


  
#end
